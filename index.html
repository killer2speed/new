<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>EFOOTBALL Server Analyzer PRO</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0f0;
            min-height: 100vh;
            padding: 15px;
            position: relative;
            overflow-x: hidden;
        }
        body::before{
            content:'';
            position:fixed; top:0; left:0; width:100%; height:100%;
            background:
                linear-gradient(0deg, transparent 24%, rgba(0,255,0,.05) 25%, rgba(0,255,0,.05) 26%, transparent 27%, transparent 74%, rgba(0,255,0,.05) 75%, rgba(0,255,0,.05) 76%, transparent 77%, transparent),
                linear-gradient(90deg, transparent 24%, rgba(0,255,0,.05) 25%, rgba(0,255,0,.05) 26%, transparent 27%, transparent 74%, rgba(0,255,0,.05) 75%, rgba(0,255,0,.05) 76%, transparent 77%, transparent);
            background-size:50px 50px; pointer-events:none; z-index:0;
        }
        .container{ max-width:500px; margin:0 auto; position:relative; z-index:1; }
        .no-internet-screen{ display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:9999; justify-content:center; align-items:center; flex-direction:column; }
        .no-internet-screen.active{ display:flex; }
        .no-internet-icon{ font-size:80px; margin-bottom:20px; animation:pulse 2s ease-in-out infinite; }
        .no-internet-text{ font-size:24px; color:#f00; text-align:center; text-shadow:0 0 20px #f00; animation:textGlow 1.5s ease-in-out infinite; }
        .header{ background: rgba(0,255,0,0.1); border:2px solid #0f0; padding:20px; margin-bottom:20px; position:relative; box-shadow:0 0 20px rgba(0,255,0,0.3); animation:glowBorder 2s ease-in-out infinite; }
        @keyframes glowBorder{ 0%,100%{box-shadow:0 0 20px rgba(0,255,0,0.3);} 50%{box-shadow:0 0 30px rgba(0,255,0,0.6);} }
        .header::before{ content:''; position:absolute; top:-2px; left:-2px; right:-2px; bottom:-2px; background:linear-gradient(45deg,#0f0,#0a0,#0f0,#0a0); z-index:-1; filter:blur(5px); animation:borderRotate 3s linear infinite; }
        @keyframes borderRotate{ 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
        .app-title{ font-size:24px; font-weight:bold; color:#0f0; text-shadow:0 0 10px #0f0; margin-bottom:5px; animation:textGlow 1.5s ease-in-out infinite; }
        @keyframes textGlow{ 0%,100%{text-shadow:0 0 10px #0f0,0 0 20px #0f0;} 50%{text-shadow:0 0 20px #0f0,0 0 30px #0f0,0 0 40px #0f0;} }
        .app-subtitle{ font-size:14px; color:#0a0; }
        .version-badge{ position:absolute; top:15px; left:15px; background:#f00; color:#000; padding:5px 15px; border:1px solid #f00; font-size:12px; font-weight:bold; box-shadow:0 0 10px #f00; animation:pulse 2s ease-in-out infinite; }
        @keyframes pulse{ 0%,100%{transform:scale(1);} 50%{transform:scale(1.05);} }
        .info-card{ background:rgba(0,20,0,0.8); border:1px solid #0f0; padding:15px; margin-bottom:15px; box-shadow:0 0 15px rgba(0,255,0,0.2); }
        .info-row{ display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid rgba(0,255,0,0.2); }
        .info-row:last-child{ border-bottom:none; }
        .info-label{ color:#0a0; font-size:13px; }
        .info-value{ color:#0f0; font-weight:bold; font-size:14px; text-shadow:0 0 5px #0f0; }
        .status-indicator{ display:inline-flex; align-items:center; gap:8px; }
        .status-dot{ width:8px; height:8px; background:#0f0; animation:blink 1s ease-in-out infinite; box-shadow:0 0 10px #0f0; }
        .status-dot.offline{ background:#f00; box-shadow:0 0 10px #f00; }
        @keyframes blink{ 0%,100%{opacity:1;} 50%{opacity:0.3;} }
        .action-btn{ width:100%; padding:15px; border:2px solid; font-size:15px; font-weight:bold; cursor:pointer; margin-bottom:12px; position:relative; overflow:hidden; transition:all .3s ease; font-family:'Courier New', monospace; text-transform:uppercase; letter-spacing:2px; }
        .action-btn::before{ content:''; position:absolute; top:0; left:-100%; width:100%; height:100%; background:rgba(255,255,255,0.1); transition:left .5s; }
        .action-btn:hover::before{ left:100%; }
        .action-btn:disabled{ opacity:0.5; cursor:not-allowed; }
        .btn-epic{ background:rgba(255,255,0,0.2); border-color:#ffff00; color:#ffff00; box-shadow:0 0 15px rgba(255,255,0,0.3); }
        .btn-showtime{ background:rgba(255,0,255,0.2); border-color:#ff00ff; color:#ff00ff; box-shadow:0 0 15px rgba(255,0,255,0.3); }
        .btn-stars{ background:rgba(0,255,0,0.2); border-color:#0f0; color:#0f0; box-shadow:0 0 15px rgba(0,255,0,0.3); }
        .btn-telegram{ background:rgba(0,136,204,0.2); border-color:#0088cc; color:#0088cc; box-shadow:0 0 15px rgba(0,136,204,0.3); }
        .modal{ display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:1000; justify-content:center; align-items:center; }
        .modal-content{ background:rgba(0,20,0,0.95); border:2px solid #0f0; padding:30px; max-width:400px; width:90%; box-shadow:0 0 30px rgba(0,255,0,0.5); position:relative; max-height:90vh; overflow-y:auto; }
        .modal-title{ font-size:20px; color:#0f0; text-align:center; margin-bottom:20px; text-shadow:0 0 10px #0f0; }
        .form-group{ margin-bottom:20px; }
        .form-label{ display:block; color:#0a0; margin-bottom:10px; font-size:14px; }
        .form-select{ width:100%; padding:12px; background:rgba(0,20,0,0.8); border:1px solid #0f0; color:#0f0; font-family:'Courier New', monospace; font-size:14px; cursor:pointer; box-shadow:0 0 10px rgba(0,255,0,0.2); }
        .form-select:focus{ outline:none; box-shadow:0 0 20px rgba(0,255,0,0.4); }
        .form-select option{ background:#001a00; color:#0f0; }

        /* Hacker-style select (applied to both selects) */
        .form-select.hacker{
            background: linear-gradient(90deg, rgba(0,8,0,0.95), rgba(0,18,0,0.85));
            border: 1px solid rgba(0,255,0,0.85);
            box-shadow: 0 0 30px rgba(0,255,0,0.12), inset 0 0 10px rgba(0,255,0,0.04);
            color: #0f0;
            font-weight: bold;
            letter-spacing: 1px;
        }
        .form-select.hacker option{
            background: linear-gradient(0deg,#001100,#001100);
            color: #0f0;
        }

        .progress-bar{ width:100%; height:30px; background:rgba(0,50,0,0.5); border:1px solid #0f0; margin:20px 0; position:relative; overflow:hidden; }
        .progress-fill{ height:100%; background:#0f0; width:0%; transition:width .1s linear; box-shadow:0 0 10px #0f0; }
        .progress-text{ position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:#000; font-weight:bold; font-size:14px; text-shadow:0 0 5px #0f0; }
        .status-message{ text-align:center; color:#0f0; font-size:14px; margin:15px 0; min-height:40px; }
        .percentage-display{ font-size:48px; color:#0f0; text-align:center; margin:20px 0; text-shadow:0 0 20px #0f0; animation:numberGlow 1s ease-in-out infinite; }
        @keyframes numberGlow{ 0%,100%{text-shadow:0 0 20px #0f0;} 50%{text-shadow:0 0 30px #0f0,0 0 40px #0f0;} }
        .result-message{ text-align:center; font-size:16px; padding:15px; margin:15px 0; border:2px solid; border-radius:5px; }
        .result-bad{ color:#f00; border-color:#f00; background:rgba(255,0,0,0.1); }
        .result-weak{ color:#ff0; border-color:#ff0; background:rgba(255,255,0,0.1); }
        .result-medium{ color:#fa0; border-color:#fa0; background:rgba(255,170,0,0.1); }
        .result-good{ color:#0f0; border-color:#0f0; background:rgba(0,255,0,0.1); }
        .close-btn, .confirm-btn{ width:100%; padding:12px; background:rgba(0,255,0,0.2); border:1px solid #0f0; color:#0f0; cursor:pointer; font-family:'Courier New', monospace; font-weight:bold; font-size:14px; margin-top:10px; }
        .close-btn:hover, .confirm-btn:hover{ background:rgba(0,255,0,0.3); }
        .stats-grid{ display:grid; grid-template-columns:repeat(2,1fr); gap:10px; margin-bottom:15px; }
        .stat-card{ background:rgba(0,20,0,0.8); border:1px solid #0f0; padding:12px; text-align:center; }
        .stat-value{ font-size:20px; font-weight:bold; color:#0f0; margin-bottom:5px; text-shadow:0 0 10px #0f0; }
        .stat-label{ font-size:11px; color:#0a0; }
        .footer{ text-align:center; padding:20px; color:#0a0; font-size:11px; border-top:1px solid rgba(0,255,0,0.2); margin-top:20px; }
        .console-log{ background:rgba(0,10,0,0.9); border:1px solid #0f0; padding:15px; margin:15px 0; font-size:12px; max-height:300px; overflow-y:auto; text-align:left; }
        .console-line{ margin:5px 0; white-space:pre-line; line-height:1.5; display:block; min-height:1.3em; }
        .typing-caret{ display:inline-block; width:8px; height:18px; background-color:#0f0; margin-left:3px; animation:blinkCaret .7s infinite; }
        @keyframes blinkCaret{ 0%,50%{opacity:1;} 51%,100%{opacity:0;} }
        .moving-dot{ display:inline-block; margin-left:5px; color:#0f0; animation:moveDotAnim 1.2s infinite; }
        @keyframes moveDotAnim{ 0%{opacity:0.2; transform:translateX(0);} 25%{opacity:1; transform:translateX(3px);} 50%{opacity:0.6; transform:translateX(6px);} 75%{opacity:1; transform:translateX(3px);} 100%{opacity:0.2; transform:translateX(0);} }
        .maintenance-warning{ background:rgba(255,0,0,0.2); border:2px solid #f00; padding:20px; margin:20px 0; text-align:center; color:#f00; font-weight:bold; }

        /* ====== Modified Cooldown banner: now centered & red ====== */
	        .cooldown-banner{
	            position:fixed;
	            top:0;
	            left:0;
	            width:100%;
	            z-index:3000;
	            display:flex;
	            justify-content:center;
	            pointer-events:none;
	        }
        .cooldown-box{
            pointer-events:auto;
            background:rgba(24,0,0,0.98);
            border:2px solid #f00;
            color:#f00;
            padding:16px 26px;
            margin:10px;
            font-weight:bold;
            border-radius:8px;
            box-shadow:0 0 30px rgba(255,0,0,0.18);
            min-width:260px;
            text-align:center;
            font-size:16px;
            letter-spacing:1px;
        }
    </style>
</head>
<body>
    <!-- No Internet Screen -->
    <div class="no-internet-screen" id="noInternetScreen">
        <div class="no-internet-icon">âš ï¸</div>
        <div class="no-internet-text">
            NO INTERNET CONNECTION<br>
            Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª<br><br>
            [PLEASE CHECK YOUR CONNECTION]
        </div>
    </div>

    <div class="container" id="mainContainer">
        <div class="header">
            <div class="version-badge">v5.7 PRO</div>
            <div class="app-title">âš½ EFOOTBALL</div>
            <div class="app-subtitle">SERVER ANALYZER - PRO EDITION</div>
        </div>

        <div class="info-card">
            <div class="info-row">
                <span class="info-label">[IP ADDRESS]</span>
                <span class="info-value" id="ipAddress">Loading...</span>
            </div>
            <div class="info-row">
                <span class="info-label">[SERVER STATUS]</span>
                <span class="info-value status-indicator">
                    <span class="status-dot" id="statusDot"></span>
                    <span id="serverStatus">ACTIVE & STABLE</span>
                </span>
            </div>
            <div class="info-row">
                <span class="info-label">[ONLINE USERS]</span>
                <span class="info-value" id="onlineUsers">1985</span>
            </div>
            <div class="info-row">
                <span class="info-label">[SERVER TIME]</span>
                <span class="info-value" id="serverTime">--:--:--</span>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="uptime">99.9%</div>
                <div class="stat-label">[UPTIME]</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="ping">--ms</div>
                <div class="stat-label">[PING]</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="newToday">+247</div>
                <div class="stat-label">[NEW TODAY]</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">5.7</div>
                <div class="stat-label">[VERSION]</div>
            </div>
        </div>

        <button class="action-btn btn-epic" onclick="initiateScan('EPIC')" id="btnEpic" disabled>ğŸ® EPIC BOX SCAN</button>
        <button class="action-btn btn-showtime" onclick="initiateScan('SHOWTIME')" id="btnShowtime" disabled>ğŸ¯ SHOWTIME BOX SCAN</button>
        <button class="action-btn btn-stars" onclick="initiateScan('POTW')" id="btnPotw" disabled>â­ POTW BOX SCAN</button>
        <button class="action-btn btn-telegram" onclick="openTelegram()">ğŸ“± JOIN TELEGRAM CHANNEL</button>

        <div class="footer">
            [POWERED BY EFOOTBALL PRO Â© 2025]<br>
            [ALL RIGHTS RESERVED]<br>
            [PRO EDITION v5.7]
        </div>
    </div>

    <!-- Setup Modal -->
    <div class="modal" id="setupModal">
        <div class="modal-content">
            <div class="modal-title" style="font-size: 18px;">[SYSTEM CONFIGURATION]</div>
            <div class="form-group">
                <label class="form-label">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù‡Ø§ØªÙ / Device Type:</label>
                <select class="form-select hacker" id="deviceType">
                    <option value="">-- Ø§Ø®ØªØ± --</option>
                    <option value="Android">ğŸ“± Android</option>
                    <option value="iPhone">ğŸ iPhone</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙŠØ±ÙØ± / Select Server:</label>
                <select class="form-select hacker" id="continent">
                    <option value="">-- Ø§Ø®ØªØ± --</option>
                    <option value="Asia">ğŸŒ Ø¢Ø³ÙŠØ§ - Asia</option>
                    <option value="Europe">ğŸŒ Ø£ÙˆØ±ÙˆØ¨Ø§ - Europe</option>
                    <option value="Africa">ğŸŒ Ø£ÙØ±ÙŠÙ‚ÙŠØ§ - Africa</option>
                    <option value="Americas">ğŸŒ Ø§Ù„Ø£Ù…Ø±ÙŠÙƒØªÙŠÙ† - Americas</option>
                    <option value="Oceania">ğŸŒ Ø£ÙˆÙ‚ÙŠØ§Ù†ÙˆØ³ÙŠØ§ - Oceania</option>
                </select>
            </div>
            <button class="confirm-btn" onclick="confirmSetup()">ØªØ£ÙƒÙŠØ¯ / Confirm</button>
        </div>
    </div>

    <!-- Error Modal -->
    <div class="modal" id="errorModal">
        <div class="modal-content">
            <div class="modal-title" style="color: #f00; text-shadow:0 0 10px #f00;">[ERROR]</div>
            <div class="result-message result-bad" id="errorMessage" style="text-align: center; font-size: 14px;"></div>
            <button class="close-btn" onclick="document.getElementById('errorModal').style.display='none';" style="border-color: #f00; color: #f00;">Ø¥ØºÙ„Ø§Ù‚ / Close</button>
        </div>
    </div>

    <!-- Connection Modal -->
    <div class="modal" id="connectionModal">
        <div class="modal-content">
            <div class="modal-title" id="connectionTitle" style="font-size: 18px;">[CONNECTING TO SERVER]</div>
            <div class="status-message" id="connectionStatus"></div>
            <div class="console-log" id="consoleLog"></div>
            <div class="progress-bar" id="connectionProgress" style="display:none;">
                <div class="progress-fill" id="connectionFill"></div>
                <div class="progress-text" id="connectionText">0%</div>
            </div>
        </div>
    </div>

    <!-- Results Modal -->
    <div class="modal" id="resultsModal">
        <div class="modal-content">
            <div class="modal-title">[ANALYSIS COMPLETE]</div>
            <div class="percentage-display" id="percentageDisplay"></div>
            <div class="result-message" id="resultMessage"></div>
            <button class="close-btn" onclick="rescanServer()" style="background: rgba(0,255,0,0.3); border:2px solid #0f0; font-size:16px; letter-spacing:2px;">ğŸ”„ RESCAN SERVER</button>
            <button class="close-btn" onclick="closeResults()">Ø¥ØºÙ„Ø§Ù‚ / Close</button>
        </div>
    </div>

    <!-- Maintenance Modal -->
    <div class="modal" id="maintenanceModal">
        <div class="modal-content">
            <div class="modal-title">[âš ï¸ SERVER MAINTENANCE]</div>
            <div class="maintenance-warning">
                Ø§Ù„Ø³ÙŠØ±ÙØ± ØªØ­Øª Ø§Ù„ØµÙŠØ§Ù†Ø©<br>
                Server Under Maintenance<br><br>
                <strong>ÙƒÙ„ Ø®Ù…ÙŠØ³ Ù…Ù† 04:00 ØµØ¨Ø§Ø­Ø§Ù‹ - 10:00 ØµØ¨Ø§Ø­Ø§Ù‹</strong><br>
                Every Thursday 04:00 AM - 10:00 AM<br><br>
                ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹<br>
                Please try again later
            </div>
            <button class="close-btn" onclick="closeMaintenance()">Ø¥ØºÙ„Ø§Ù‚ / Close</button>
        </div>
    </div>

    <!-- Cooldown banner container -->
    <div class="cooldown-banner" id="cooldownBanner" aria-hidden="true"></div>

    <script>
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playTypingSound() {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.frequency.value = 700 + Math.random() * 300;
            osc.type = 'sawtooth';
            gain.gain.setValueAtTime(0.08, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.06);
            osc.start();
            osc.stop(audioContext.currentTime + 0.06);
        }

        function playConnectSound() {
            [400,600,800].forEach((freq,i)=>{
                setTimeout(()=>{
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    osc.connect(gain); gain.connect(audioContext.destination);
                    osc.frequency.value=freq; osc.type='sine';
                    gain.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.18);
                    osc.start(); osc.stop(audioContext.currentTime + 0.18);
                }, i*100);
            });
        }

        function playSuccessBeep() {
            const o = audioContext.createOscillator(); const g = audioContext.createGain();
            o.connect(g); g.connect(audioContext.destination);
            o.frequency.value = 1000; o.type='sine';
            g.gain.setValueAtTime(0.15, audioContext.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.12);
            o.start(); o.stop(audioContext.currentTime + 0.12);
        }

        function playTickSound() {
            const o = audioContext.createOscillator(); const g = audioContext.createGain();
            o.connect(g); g.connect(audioContext.destination);
            o.frequency.value = 1200; o.type='sine';
            g.gain.setValueAtTime(0.02, audioContext.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.03);
            o.start(); o.stop(audioContext.currentTime + 0.03);
        }

        function playPopSound() {
            const o = audioContext.createOscillator(); const g = audioContext.createGain();
            o.connect(g); g.connect(audioContext.destination);
            o.frequency.value = 600; o.type='sine';
            g.gain.setValueAtTime(0.05, audioContext.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);
            o.start(); o.stop(audioContext.currentTime + 0.1);
        }

        function playErrorSound() {
            const o = audioContext.createOscillator(); const g = audioContext.createGain();
            o.connect(g); g.connect(audioContext.destination);
            o.frequency.value = 200; o.type='sawtooth';
            g.gain.setValueAtTime(0.1, audioContext.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);
            o.start(); o.stop(audioContext.currentTime + 0.3);
        }

        function playStartupSound() {
            [500,700,900,1100].forEach((freq,i)=>{
                setTimeout(()=>{
                    const o = audioContext.createOscillator(); const g = audioContext.createGain();
                    o.connect(g); g.connect(audioContext.destination);
                    o.frequency.value=freq; o.type='sine';
                    g.gain.setValueAtTime(0.08, audioContext.currentTime);
                    g.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.15);
                    o.start(); o.stop(audioContext.currentTime + 0.15);
                }, i*80);
            });
        }

        let isOnline = navigator.onLine;
        let wasProcessing = false;
        let allIntervals = [];
        let allTimeouts = [];

        function stopAllProcesses(){
            allIntervals.forEach(id=>clearInterval(id));
            allTimeouts.forEach(id=>clearTimeout(id));
            allIntervals=[]; allTimeouts=[];
        }

        function handleOffline(){
            isOnline=false;
            playErrorSound();
            stopAllProcesses();
            document.getElementById('noInternetScreen').classList.add('active');
            document.getElementById('mainContainer').style.display='none';
            document.getElementById('serverStatus').textContent='OFFLINE';
            document.getElementById('statusDot').classList.add('offline');
            document.querySelectorAll('.modal').forEach(modal => modal.style.display = 'none');
        }

        function handleOnline(){
            isOnline=true;
            playStartupSound();
            document.getElementById('noInternetScreen').classList.remove('active');
            document.getElementById('mainContainer').style.display='block';
            document.getElementById('serverStatus').textContent='ACTIVE & STABLE';
            document.getElementById('statusDot').classList.remove('offline');
            initializeApp();
        }

        window.addEventListener('online', handleOnline);
        window.addEventListener('offline', handleOffline);

        async function typewriterEffect(element, text, addDot = false) {
            return new Promise(async (resolve) => {
                let dot = null;
                if (addDot) {
                    dot = document.createElement("span");
                    dot.classList.add("moving-dot");
                    dot.textContent = ".";
                    element.appendChild(dot);
                }

                const caret = document.createElement('span');
                caret.className = 'typing-caret';
                element.appendChild(caret);

                let i = 0;
                const baseSpeed = 18 + Math.random() * 45;

                function charDelay(char, nextChar) {
                    if (char === '.' && nextChar === '.' ) return baseSpeed + 40;
                    if (char === '.' || char === '!' || char === '?') return baseSpeed + 180;
                    if (char === ',' || char === ';' || char === ':') return baseSpeed + 120;
                    if (char === ' ') return baseSpeed + 10;
                    return baseSpeed + Math.random() * 40;
                }

                while (i < text.length) {
                    if (!isOnline) {
                        if (dot) dot.remove();
                        caret.remove();
                        resolve();
                        return;
                    }

                    const ch = text.charAt(i);
                    const nextCh = (i + 1 < text.length) ? text.charAt(i + 1) : '';
                    element.insertBefore(document.createTextNode(ch), caret);

                    const delay = charDelay(ch, nextCh);
                    if (ch === '\n') {
                        await sleep(delay + 220);
                    } else {
                        await sleep(delay);
                    }
                    i++;
                }

                element.appendChild(document.createTextNode("\n"));
                if (dot) dot.remove();
                caret.remove();
                await sleep(350);
                resolve();
            });
        }

        function sleep(ms) {
            return new Promise((res) => {
                const id = setTimeout(res, ms);
                allTimeouts.push(id);
            });
        }

        let userIP = 'Loading...';
        let currentPing = '--';

        async function fetchRealIP(){
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                userIP = data.ip;
                document.getElementById('ipAddress').textContent = userIP;
            } catch (e) {
                userIP = '156.199.188.171';
                document.getElementById('ipAddress').textContent = userIP;
            }
        }

        async function measurePing(){
            if (!isOnline) return;
            const start = Date.now();
            try {
                await fetch('https://www.google.com/favicon.ico', { mode: 'no-cors', cache: 'no-store' });
                const ping = Date.now() - start;
                currentPing = Math.min(ping, 150);
                document.getElementById('ping').textContent = currentPing + 'ms';
                playTickSound();
            } catch (e) {
                currentPing = Math.floor(25 + Math.random()*30);
                document.getElementById('ping').textContent = currentPing + 'ms';
            }
        }

        let onlineUsers = 1985;
        let newToday = 247;
        let uptime = 99.9;

        function initializeStats(){
            const savedUsers = localStorage.getItem('onlineUsers');
            const savedNewToday = localStorage.getItem('newToday');
            if (savedUsers) onlineUsers = parseInt(savedUsers);
            else onlineUsers = Math.floor(1900 + Math.random() * 151);
            if (savedNewToday) newToday = parseInt(savedNewToday);
            else newToday = Math.floor(200 + Math.random() * 101);
            document.getElementById('onlineUsers').textContent = onlineUsers;
            document.getElementById('newToday').textContent = '+' + newToday;
        }

        function updateOnlineUsers(){
            if (!isOnline) return;
            const change = Math.random() > 0.5 ? Math.floor(Math.random()*5) + 1 : -(Math.floor(Math.random()*5)+1);
            onlineUsers = Math.max(1900, Math.min(2100, onlineUsers + change));
            document.getElementById('onlineUsers').textContent = onlineUsers;
            localStorage.setItem('onlineUsers', onlineUsers);
            playPopSound();
        }

        function updateNewToday(){
            if (!isOnline) return;
            const change = Math.random() > 0.5 ? 2 : 1;
            newToday += change;
            document.getElementById('newToday').textContent = '+' + newToday;
            localStorage.setItem('newToday', newToday);
            playTickSound();
        }

        function updateUptime(){
            if (!isOnline) return;
            uptime = (99.7 + Math.random()*0.2).toFixed(1);
            document.getElementById('uptime').textContent = uptime + '%';
        }

        function updateTime(){
            const now = new Date();
            const h = String(now.getHours()).padStart(2,'0');
            const m = String(now.getMinutes()).padStart(2,'0');
            const s = String(now.getSeconds()).padStart(2,'0');
            document.getElementById('serverTime').textContent = `${h}:${m}:${s}`;
        }

        function initializeApp(){
            stopAllProcesses();
            initializeStats();
            fetchRealIP();
            measurePing();
            const pingInterval = setInterval(measurePing, 2000); allIntervals.push(pingInterval);
            updateTime(); const timeInterval = setInterval(updateTime, 1000); allIntervals.push(timeInterval);
            const usersInterval = setInterval(updateOnlineUsers, 5000 + Math.random()*5000); allIntervals.push(usersInterval);
            const newTodayInterval = setInterval(updateNewToday, 30000 + Math.random()*30000); allIntervals.push(newTodayInterval);
            const uptimeInterval = setInterval(updateUptime, 30000); allIntervals.push(uptimeInterval);

            // check cooldown on init
            checkExistingCooldown();
        }



        let userConfig = { deviceType: null, continent: null };
        let currentScanType = '';

        window.addEventListener('load', ()=>{
            if (isOnline) {
                initializeApp();
                setTimeout(()=>{
                    document.getElementById('setupModal').style.display = 'flex';
                    playConnectSound();
                }, 500);
            } else handleOffline();
        });

        function confirmSetup(){
            const deviceType = document.getElementById('deviceType').value;
            const continent = document.getElementById('continent').value;
            if (!deviceType || !continent) {
                playErrorSound();
                const message = 'ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„Ù‚Ø§Ø±Ø©\nPlease select device type and continent';
                const errorModal = document.getElementById('errorModal');
                document.getElementById('errorMessage').innerHTML = message.replace(/\n/g, '<br>');
                errorModal.style.display = 'flex';
                return;
            }
            userConfig.deviceType = deviceType;
            userConfig.continent = continent;
            document.getElementById('setupModal').style.display = 'none';
            document.getElementById('btnEpic').disabled = false;
            document.getElementById('btnShowtime').disabled = false;
            document.getElementById('btnPotw').disabled = false;
            playSuccessBeep();

            // If there's an active cooldown, immediately disable again
            checkExistingCooldown();
        }

        function initiateScan(type){
            if (!isOnline) { playErrorSound(); alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª\nNo internet connection'); return; }


            // prevent starting if cooldown active
            const cooldownEnd = parseInt(localStorage.getItem('cooldownEnd') || '0');
            if (Date.now() < cooldownEnd) {
                playErrorSound();
                alert('ÙŠÙˆØ¬Ø¯ ÙˆÙ‚Øª Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ø¨Ù„ Ø§Ù„ÙØ­Øµ Ø§Ù„ØªØ§Ù„ÙŠ. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.');
                return;
            }

            currentScanType = type;
            startConnection();
        }

        async function startConnection(){
            const modal = document.getElementById('connectionModal');
            const consoleLog = document.getElementById('consoleLog');
            const progressBar = document.getElementById('connectionProgress');

            modal.style.display = 'flex';
            consoleLog.innerHTML = '';
            progressBar.style.display = 'block';

            wasProcessing = true;
            playConnectSound();

            const messages = [
                'CONNECTING TO SERVER',
                '[>] Initializing secure connection...',
                '[>] Establishing encrypted tunnel...',
                '[>] Connecting to ' + (userConfig.continent || 'Americas') + ' server...',
                '[>] Device: ' + (userConfig.deviceType || 'Android') + ' detected',
                '[>] Authenticating credentials...',
                '[>] Spoofing user agent...',
                '[>] Bypassing firewall restrictions...',
                '[>] Exploiting zero-day vulnerability...',
                '[>] Establishing backdoor access...',
                '[>] Bypassing security protocols...',
                '[>] Accessing game server database...',
                '[>] Injecting analysis module...',
                '[>] Scanning ' + currentScanType + ' box data...',
                '[>] Extracting pack metadata...',
                '[>] Running quantum probability simulation...',
                '[>] Optimizing hack parameters...',
                '[>] Processing server response...',
                '[>] Decrypting package information...',
                '[>] Analyzing probability algorithms...',
                '[>] Calculating success rate...',
                '[>] Finalizing connection...'
            ];

            startProgressBar();
            
            for (let i = 0; i < messages.length; i++){
                if (!isOnline) return;
                const line = document.createElement('div');
                line.className = 'console-line';
                consoleLog.appendChild(line);

                const isConnecting = messages[i].includes("CONNECTING TO SERVER") || messages[i].includes("Connecting to");
                await typewriterEffect(line, messages[i], isConnecting);

                consoleLog.scrollTop = consoleLog.scrollHeight;
            }
        }

        async function startProgressBar(){
            if (!isOnline) return;
            const progressBar = document.getElementById('connectionProgress');
            const progressFill = document.getElementById('connectionFill');
            const progressText = document.getElementById('connectionText');
            progressBar.style.display = 'block';
            const duration = (15 + Math.random() * 30) * 1000;
            const steps = 100;
            const stepDuration = duration / steps;
            for (let progress = 0; progress <= 100; progress++){
                if (!isOnline) return;
                progressFill.style.width = progress + '%';
                progressText.textContent = progress + '%';
                if (progress % 10 === 0) playTickSound();
                await sleep(stepDuration);
            }
            if (!isOnline) return;
            connectionSuccess();
        }

        async function connectionSuccess(){
            playSuccessBeep();
            const line = document.createElement('div');
            line.className = 'console-line';
            line.style.color = '#0f0';
            line.style.fontWeight = 'bold';
            document.getElementById('consoleLog').appendChild(line);
            await typewriterEffect(line, '[âœ“ CONNECTED TO GAME SERVER SUCCESSFULLY]', false);
            await sleep(1200);
            document.getElementById('connectionModal').style.display = 'none';
            wasProcessing = false;
            analyzePackage();
        }

        function analyzePackage(){
            if (!isOnline) return;
            playConnectSound();
            const rand = Math.random() * 100;
            let percentage;
            if (rand < 50) percentage = Math.floor(Math.random()*50) + 1;
            else if (rand < 80) percentage = Math.floor(Math.random()*25) + 51;
            else if (rand < 95) percentage = Math.floor(Math.random()*14) + 76;
            else percentage = Math.floor(Math.random()*6) + 90;
            showResults(percentage);
        }

        // helper to enable/disable scan buttons
        function setScanButtonsEnabled(enabled){
            document.getElementById('btnEpic').disabled = !enabled;
            document.getElementById('btnShowtime').disabled = !enabled;
            document.getElementById('btnPotw').disabled = !enabled;
        }

        // apply cooldown UI: show banner and disable buttons
        let cooldownIntervalId = null;
        function applyCooldownUI(cooldownEnd){
            setScanButtonsEnabled(false);

            const banner = document.getElementById('cooldownBanner');
            banner.innerHTML = '';
            const box = document.createElement('div');
            box.className = 'cooldown-box';
            banner.appendChild(box);

            function update(){
                const remaining = Math.max(0, Math.ceil((cooldownEnd - Date.now()) / 1000));
                const mins = Math.floor(remaining / 60);
                const secs = remaining % 60;
                box.textContent = 'â³ [COOL DOWN] ' + mins + ':' + (secs < 10 ? '0' : '') + secs + ' - Please wait';
                if (remaining <= 0) {
                    clearInterval(cooldownIntervalId);
                    cooldownIntervalId = null;
                    banner.innerHTML = '';
                    localStorage.removeItem('cooldownEnd');
                    // re-enable buttons only if setup already confirmed
                    if (userConfig.deviceType && userConfig.continent) setScanButtonsEnabled(true);
                }
            }

            update();
            if (cooldownIntervalId) clearInterval(cooldownIntervalId);
            cooldownIntervalId = setInterval(update, 1000);
        }

        // check on load if cooldown exists and apply
        function checkExistingCooldown(){
            const cooldownEnd = parseInt(localStorage.getItem('cooldownEnd') || '0');
            if (Date.now() < cooldownEnd) {
                applyCooldownUI(cooldownEnd);
            } else {
                // no active cooldown: enable buttons only after setup
                if (userConfig.deviceType && userConfig.continent) {
                    setScanButtonsEnabled(true);
                } else {
                    setScanButtonsEnabled(false);
                }
            }
        }

        function showResults(percentage){
            const modal = document.getElementById('resultsModal');
            const percentageDisplay = document.getElementById('percentageDisplay');
            const resultMessage = document.getElementById('resultMessage');
            modal.style.display = 'flex';
            percentageDisplay.textContent = percentage + '%';

            if (percentage <= 50){
                playErrorSound();
                resultMessage.className = 'result-message result-bad';
                resultMessage.innerHTML = 'ğŸ˜ [Ø§Ù„Ù†Ø³Ø¨Ø© ØºÙŠØ± Ø¬ÙŠØ¯Ø©]<br><br><strong>BAD PROBABILITY</strong><br>Ù„Ø§ ØªÙØªØ­ Ø§Ù„Ø¨Ø§ÙƒØ¬ Ø§Ù„Ø¢Ù†<br>Do not open the package now<br><br>Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ ÙÙŠ ÙˆÙ‚Øª Ù„Ø§Ø­Ù‚<br>Try again later for better results';
            } else if (percentage <= 75){
                playTickSound();
                resultMessage.className = 'result-message result-weak';
                resultMessage.innerHTML = 'âš ï¸ [Ø§Ù„Ù†Ø³Ø¨Ø© Ø¶Ø¹ÙŠÙØ©]<br><br><strong>WEAK PROBABILITY</strong><br>Ø§Ù„Ù†Ø³Ø¨Ø© Ù„ÙŠØ³Øª Ø¬ÙŠØ¯Ø©<br>The probability is not good<br><br>ÙŠÙÙ†ØµØ­ Ø¨Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰<br>Recommended to try again';
            } else if (percentage <= 89){
                playPopSound();
                resultMessage.className = 'result-message result-medium';
                resultMessage.innerHTML = 'âš¡ [Ø§Ù„Ù†Ø³Ø¨Ø© Ù…ØªÙˆØ³Ø·Ø©]<br><br><strong>MEDIUM PROBABILITY</strong><br>Ù…Ù‚Ø¨ÙˆÙ„ Ù„Ù„ÙØªØ­<br>Acceptable to open<br><br>Ù„ÙƒÙ† ÙŠÙÙØ¶Ù„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ø© Ø£ÙØ¶Ù„<br>But better to try for higher percentage';
            } else {
                playSuccessBeep(); setTimeout(()=>playSuccessBeep(),200);
                resultMessage.className = 'result-message result-good';
                resultMessage.innerHTML = 'âœ… [Ø§Ù„Ù†Ø³Ø¨Ø© Ø¬ÙŠØ¯Ø© Ù„Ù„ÙØªØ­]<br><br><strong>GOOD PROBABILITY!</strong><br>ğŸ‰ Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚!<br>ğŸ‰ Good luck!<br><br>Ø§Ù„ÙˆÙ‚Øª Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„ÙØªØ­<br>Perfect time to open the package';
            }

            // ======= START: Cooldown logic =======
            const now = Date.now();
            let cooldownEnd = parseInt(localStorage.getItem('cooldownEnd') || '0');

            if (now >= cooldownEnd) {
                // Ø¥Ø°Ø§ Ù„Ø§ ÙŠÙˆØ¬Ø¯ cooldown Ø³Ø§Ø¨Ù‚ Ø£Ùˆ Ø§Ù†ØªÙ‡Ù‰ -> Ù†ÙˆÙ„Ø¯ ÙˆØ§Ø­Ø¯ Ø¬Ø¯ÙŠØ¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹
                const randomCooldown = (120 + Math.random() * 180) * 1000; // 120s - 300s
                cooldownEnd = now + Math.floor(randomCooldown);
                localStorage.setItem('cooldownEnd', cooldownEnd);
            }

            // Apply the UI (banner + disabling buttons)
            applyCooldownUI(cooldownEnd);
            // ======= END: Cooldown logic =======

            const autoTelegram = setTimeout(()=>{ openTelegram(); }, 4000);
            allTimeouts.push(autoTelegram);

            // keep previous cooldown-resume behavior (reload after countdown finished)
            // (applyCooldownUI already removes cooldownEnd and re-enables buttons when done)
        }

        function closeResults(){ playTickSound(); document.getElementById('resultsModal').style.display='none'; }
        function rescanServer(){ 
            playSuccessBeep(); 
            document.getElementById('resultsModal').style.display='none';
            openTelegram();
        }
        function closeMaintenance(){ playTickSound(); document.getElementById('maintenanceModal').style.display='none'; }
        function openTelegram(){ playTickSound(); window.open('https://t.me/pes224', '_blank'); }

        // if offline initially
        if (!isOnline) handleOffline();
    </script>
</body>
</html>